import{C as O,ap as be,af as ae,P as le,D as we,d as T,S as Y,h as B,G as E,al as Ce,U as se,q as Ee,o as _,c as N,x as F,u as e,L as C,j as o,Z as ne,Q as q,m as G,n as z,_ as J,a0 as Q,aq as X,ar as Ve,T as Se,e as $,k as H,g as h,t as S,i as t,W as Te,aa as Be,r as j,a as ze,a5 as ee,f as Ne,F as $e,b as Pe,a8 as Ue,a9 as K,ak as xe}from"./index-7145d906.js";import{E as Ie}from"./el-overlay-54ff3589.js";import{E as Le,a as Ae}from"./el-form-item-37c64c9e.js";import{E as De}from"./el-input-a8b97c2f.js";import{E as Re,a as Fe}from"./el-select-f2af1389.js";import{a as te,b as je}from"./el-scrollbar-5153f5ea.js";import{E as Ke}from"./el-upload-a8a33e05.js";/* empty css                */import{E as He,_ as Me}from"./index-618ec6bb.js";import{b as oe,E as M}from"./el-button-3b52053a.js";import{u as Oe}from"./useCopy-60917155.js";import{C as Ye}from"./Copy-f41f7191.js";import"./el-checkbox-1835af1c.js";import{h as R}from"./index-cd4eb7cd.js";import{u as L}from"./useValidate-10313544.js";import{C as re}from"./event-9519ab40.js";import"./refs-0ea3f117.js";import"./use-form-item-ff632249.js";import"./error-78e43d3e.js";import"./baseClone-cd11f5db.js";import"./Uint8Array-636aa068.js";import"./isNil-c75b1b34.js";import"./isEqual-0384efb4.js";import"./plugin-vueexport-helper-c27b6911.js";const qe=O({size:{type:[Number,String],values:be,default:"",validator:c=>ae(c)},shape:{type:String,values:["circle","square"],default:"circle"},icon:{type:le},src:{type:String,default:""},alt:String,srcSet:String,fit:{type:we(String),default:"cover"}}),Ge={error:c=>c instanceof Event},Je=["src","alt","srcset"],Qe=T({name:"ElAvatar"}),We=T({...Qe,props:qe,emits:Ge,setup(c,{emit:g}){const f=c,u=Y("avatar"),r=B(!1),d=E(()=>{const{size:l,icon:V,shape:P}=f,a=[u.b()];return Ce(l)&&a.push(u.m(l)),V&&a.push(u.m("icon")),P&&a.push(u.m(P)),a}),k=E(()=>{const{size:l}=f;return ae(l)?u.cssVarBlock({size:se(l)||""}):void 0}),i=E(()=>({objectFit:f.fit}));Ee(()=>f.src,()=>r.value=!1);function A(l){r.value=!0,g("error",l)}return(l,V)=>(_(),N("span",{class:z(e(d)),style:F(e(k))},[(l.src||l.srcSet)&&!r.value?(_(),N("img",{key:0,src:l.src,alt:l.alt,srcset:l.srcSet,style:F(e(i)),onError:A},null,44,Je)):l.icon?(_(),C(e(q),{key:1},{default:o(()=>[(_(),C(ne(l.icon)))]),_:1})):G(l.$slots,"default",{key:2})],6))}});var Ze=J(We,[["__file","/home/runner/work/element-plus/element-plus/packages/components/avatar/src/avatar.vue"]]);const Xe=Q(Ze),et=O({checked:{type:Boolean,default:!1}}),tt={"update:checked":c=>X(c),[re]:c=>X(c)},ot=T({name:"ElCheckTag"}),at=T({...ot,props:et,emits:tt,setup(c,{emit:g}){const f=c,u=Y("check-tag"),r=E(()=>[u.b(),u.is("checked",f.checked)]),d=()=>{const k=!f.checked;g(re,k),g("update:checked",k)};return(k,i)=>(_(),N("span",{class:z(e(r)),onClick:d},[G(k.$slots,"default")],2))}});var lt=J(at,[["__file","/home/runner/work/element-plus/element-plus/packages/components/check-tag/src/check-tag.vue"]]);const st=Q(lt),nt=O({title:String,confirmButtonText:String,cancelButtonText:String,confirmButtonType:{type:String,values:oe,default:"primary"},cancelButtonType:{type:String,values:oe,default:"text"},icon:{type:le,default:()=>Ve},iconColor:{type:String,default:"#f90"},hideIcon:{type:Boolean,default:!1},hideAfter:{type:Number,default:200},teleported:te.teleported,persistent:te.persistent,width:{type:[String,Number],default:150}}),rt={confirm:c=>c instanceof MouseEvent,cancel:c=>c instanceof MouseEvent},it=T({name:"ElPopconfirm"}),ct=T({...it,props:nt,emits:rt,setup(c,{emit:g}){const f=c,{t:u}=Se(),r=Y("popconfirm"),d=B(),k=()=>{var a,D;(D=(a=d.value)==null?void 0:a.onClose)==null||D.call(a)},i=E(()=>({width:se(f.width)})),A=a=>{g("confirm",a),k()},l=a=>{g("cancel",a),k()},V=E(()=>f.confirmButtonText||u("el.popconfirm.confirmButtonText")),P=E(()=>f.cancelButtonText||u("el.popconfirm.cancelButtonText"));return(a,D)=>(_(),C(e(je),Te({ref_key:"tooltipRef",ref:d,trigger:"click",effect:"light"},a.$attrs,{"popper-class":`${e(r).namespace.value}-popover`,"popper-style":e(i),teleported:a.teleported,"fallback-placements":["bottom","top","right","left"],"hide-after":a.hideAfter,persistent:a.persistent}),{content:o(()=>[$("div",{class:z(e(r).b())},[$("div",{class:z(e(r).e("main"))},[!a.hideIcon&&a.icon?(_(),C(e(q),{key:0,class:z(e(r).e("icon")),style:F({color:a.iconColor})},{default:o(()=>[(_(),C(ne(a.icon)))]),_:1},8,["class","style"])):H("v-if",!0),h(" "+S(a.title),1)],2),$("div",{class:z(e(r).e("action"))},[t(e(M),{size:"small",type:a.cancelButtonType==="text"?"":a.cancelButtonType,text:a.cancelButtonType==="text",onClick:l},{default:o(()=>[h(S(e(P)),1)]),_:1},8,["type","text"]),t(e(M),{size:"small",type:a.confirmButtonType==="text"?"":a.confirmButtonType,text:a.confirmButtonType==="text",onClick:A},{default:o(()=>[h(S(e(V)),1)]),_:1},8,["type","text"])],2)],2)]),default:o(()=>[a.$slots.reference?G(a.$slots,"reference",{key:0}):H("v-if",!0)]),_:3},16,["popper-class","popper-style","teleported","hide-after","persistent"]))}});var pt=J(ct,[["__file","/home/runner/work/element-plus/element-plus/packages/components/popconfirm/src/popconfirm.vue"]]);const ut=Q(pt);const dt=T({__name:"index",props:{value:{default:"copy"},size:{default:"md"}},setup(c){const g=c,f=E(()=>{switch(g.size){case"mini":return 16;case"small":return 18;case"md":return 20;case"large":return 22;default:return 16}}),u=E(()=>{switch(g.size){case"mini":return"25px";case"small":return"30px";case"md":return"35px";case"large":return"40px"}});return(r,d)=>(_(),N("div",{class:z([{"h-[25px]":r.size=="mini","h-[30px]":r.size=="small","h-[35px]":r.size=="md","h-[40px]":r.size=="large"},"flex flex-row items-center justify-center flex-nowrapm-auto rounded w-full shadow overflow-hidden cursor-pointer"])},[$("div",{style:F({lineHeight:e(u)}),class:"indent-3 text-center text-white flex-1 h-full overflow-hidden text-ellipsis whitespace-nowrap bg-teal-500"},S(r.value),5),$("div",{onClick:d[0]||(d[0]=k=>e(Oe)(g.value)),class:"bg-teal-600 p-1 w-8 h-full flex items-center justify-center"},[t(e(Ye),{theme:"outline",size:e(f),fill:"#fff"},null,8,["size"])])],2))}}),mt={class:"w-full h-full"},ft=["src"],_t={class:"cursor-pointer hover:text-primary"},ht={class:"dialog-footer"},jt=T({__name:"index",setup(c){const g=Be().token,f=B([]),u=B("/api/users"),r=B(),d=B(!1),k=B(),i=j({email:"",username:"",address:"",avatar:"",password:"",roleId:""}),A=j({username:L.pleaseInput,address:L.pleaseInput,avatar:L.pleaseSelect,email:L.email,password:L.password,roleId:L.pleaseSelect}),l=j({showName:"",uploadUrl:"http://localhost:2333/api/upload",fileList:[]}),V=()=>{var m;return(m=k.value)==null?void 0:m.getList()},P=()=>{r.value.validate(m=>{if(m){const n=JSON.parse(JSON.stringify(i));l.showName=="add"&&R.post(u.value,n).then(v=>{const{code:y,message:b}=v;y===200&&(K.success(b),d.value=!1,V())}),l.showName=="edit"&&(delete n.password,R.put(u.value,n).then(v=>{const{code:y,message:b}=v;y===200&&(K.success(b),d.value=!1,V())}))}})},a=()=>{R.get("/api/role").then(m=>{const{code:n,data:v}=m;n===200&&(f.value=v)})},D=m=>{R.post(u.value+"/resetPwd",{userId:m}).then(n=>{const{code:v,message:y}=n;v===200&&(K.success(y),V())})},ie=()=>{l.showName="add",d.value=!0,W(),a()},W=()=>{l.fileList=[],Object.keys(i).forEach(m=>i[m]="")},ce=m=>{Object.keys(m).forEach(n=>i[n]=m[n]),m.avatar&&(l.fileList=[{url:m.avatar,name:m.avatar}]),l.showName="edit",a(),d.value=!0};return(m,n)=>{const v=De,y=Le,b=M,w=He,pe=dt,ue=Xe,Z=st,de=ut,me=Me,fe=q,_e=Ke,he=Re,ve=Fe,ye=Ae,ge=Ie,ke=ze("copy");return _(),N("main",mt,[t(me,{ref_key:"CURDRef",ref:k,api:e(u),queryParam:{orderBy:"createdAt",orderSort:"asc"}},{search:o(({query:s,getList:U})=>[t(y,null,{default:o(()=>[t(v,{style:{width:"200px"},onKeyup:ee(U,["enter"]),placeholder:"用户名",modelValue:s.username,"onUpdate:modelValue":x=>s.username=x,clearable:""},null,8,["onKeyup","modelValue","onUpdate:modelValue"])]),_:2},1024),t(y,null,{default:o(()=>[t(v,{style:{width:"200px"},onKeyup:ee(U,["enter"]),placeholder:"邮箱",modelValue:s.email,"onUpdate:modelValue":x=>s.email=x,clearable:""},null,8,["onKeyup","modelValue","onUpdate:modelValue"])]),_:2},1024)]),buttons:o(({tableCheck:s,handleDelete:U})=>[t(b,{plain:"",type:"primary",onClick:ie},{default:o(()=>[h("新增")]),_:1}),t(b,{plain:"",type:"danger",disabled:s.length==0,onClick:x=>U()},{default:o(()=>[h("删 除")]),_:2},1032,["disabled","onClick"])]),table:o(({handleDelete:s,viewImg:U,errorImg:x})=>[t(w,{type:"index",align:"center",label:"序号",width:"70"}),t(w,{type:"selection",align:"center",width:"55"}),t(w,{"show-overflow-tooltip":"",align:"center",prop:"id",label:"id"},{default:o(({row:p})=>[t(pe,{value:p.id,size:"mini"},null,8,["value"])]),_:1}),t(w,{"show-overflow-tooltip":"",align:"center",prop:"username",label:"用户名"}),t(w,{"show-overflow-tooltip":"",align:"center",prop:"avatar",label:"头像"},{default:o(({row:p})=>[t(ue,{class:"cursor-pointer",shape:"square",fit:"cover",size:40,src:p.avatar,onClick:I=>U({url:p.avatar}),onError:()=>!0},{default:o(()=>[$("img",{src:x},null,8,ft)]),_:2},1032,["src","onClick"])]),_:2},1024),t(w,{"show-overflow-tooltip":"",align:"center",prop:"email",label:"邮箱"},{default:o(({row:p})=>[Ne((_(),N("span",_t,[h(S(p.email),1)])),[[ke,p.email]])]),_:1}),t(w,{"show-overflow-tooltip":"",align:"center",label:"注册时间"},{default:o(({row:p})=>[h(S(m.dayjs(p.createdAt).format("YYYY-MM-DD HH:mm:ss")),1)]),_:1}),t(w,{"show-overflow-tooltip":"",align:"center",prop:"address",label:"地址"}),t(w,{"show-overflow-tooltip":"",align:"center",prop:"roleId",label:"角色"},{default:o(({row:p})=>[p.roles.length>0&&p.roles[0].key=="admin"?(_(),C(Z,{key:0,checked:""},{default:o(()=>[h(S(p.roles[0].name),1)]),_:2},1024)):(_(),C(Z,{key:1,class:"ml-2",checked:!1},{default:o(()=>{var I;return[h(S((I=p==null?void 0:p.roles[0])==null?void 0:I.name),1)]}),_:2},1024))]),_:1}),t(w,{fixed:"right",label:"操作",align:"center",width:"200"},{default:o(({row:p})=>[t(b,{onClick:I=>s(p.id),link:"",type:"danger"},{default:o(()=>[h("删除")]),_:2},1032,["onClick"]),t(b,{onClick:I=>ce(p),link:"",type:"warning"},{default:o(()=>[h("编辑")]),_:2},1032,["onClick"]),t(de,{"icon-color":"#626AEF",title:"确认重置密码?",onConfirm:I=>D(p.id)},{reference:o(()=>[t(b,{link:"",type:"success"},{default:o(()=>[h("重置密码")]),_:1})]),_:2},1032,["onConfirm"])]),_:2},1024)]),_:1},8,["api"]),t(ge,{modelValue:e(d),"onUpdate:modelValue":n[7]||(n[7]=s=>Ue(d)?d.value=s:null),title:e(l).showName,width:"500",draggable:""},{footer:o(()=>[$("span",ht,[t(b,{onClick:n[6]||(n[6]=s=>d.value=!1)},{default:o(()=>[h("取消")]),_:1}),t(b,{type:"warning",onClick:W},{default:o(()=>[h("清空")]),_:1}),t(b,{type:"primary",onClick:P},{default:o(()=>[h(" 提交 ")]),_:1})])]),default:o(()=>[t(ye,{ref_key:"formRef",ref:r,model:e(i),"status-icon":"",rules:e(A),"label-width":"auto",class:"demo-form"},{default:o(()=>[t(y,{label:"用户名",prop:"username"},{default:o(()=>[t(v,{modelValue:e(i).username,"onUpdate:modelValue":n[0]||(n[0]=s=>e(i).username=s),autocomplete:"off"},null,8,["modelValue"])]),_:1}),t(y,{label:"邮箱",prop:"email"},{default:o(()=>[t(v,{modelValue:e(i).email,"onUpdate:modelValue":n[1]||(n[1]=s=>e(i).email=s),autocomplete:"off"},null,8,["modelValue"])]),_:1}),e(l).showName=="add"?(_(),C(y,{key:0,label:"密码",prop:"password"},{default:o(()=>[t(v,{modelValue:e(i).password,"onUpdate:modelValue":n[2]||(n[2]=s=>e(i).password=s),autocomplete:"off"},null,8,["modelValue"])]),_:1})):H("",!0),t(y,{label:"头像",prop:"avatar"},{default:o(()=>[t(_e,{headers:{authorization:e(g)},"list-type":"picture-card","on-success":s=>(e(i).avatar=s.data,e(r).validateField("avatar")),"on-remove":()=>(e(r).resetFields("avatar"),e(i).avatar=""),action:e(l).uploadUrl,"file-list":e(l).fileList,"onUpdate:fileList":n[3]||(n[3]=s=>e(l).fileList=s),limit:1,accept:"image/*"},{default:o(()=>[t(fe,null,{default:o(()=>[t(e(xe))]),_:1})]),_:1},8,["headers","on-success","on-remove","action","file-list"])]),_:1}),t(y,{label:"地址",prop:"address"},{default:o(()=>[t(v,{modelValue:e(i).address,"onUpdate:modelValue":n[4]||(n[4]=s=>e(i).address=s),autocomplete:"off"},null,8,["modelValue"])]),_:1}),t(y,{label:"角色",prop:"roleId"},{default:o(()=>[t(ve,{style:{width:"100%"},modelValue:e(i).roleId,"onUpdate:modelValue":n[5]||(n[5]=s=>e(i).roleId=s),placeholder:"请选择"},{default:o(()=>[(_(!0),N($e,null,Pe(e(f),s=>(_(),C(he,{key:s.id,label:s.name,value:s.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"])])}}});export{jt as default};
